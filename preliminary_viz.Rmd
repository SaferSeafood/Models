---
title: "Preliminary Data Visualizations"
author: "Hope Hahn"
date: "2024-01-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# load in packages
library(tidyverse)
library(sf)
library(terra)
library(resample)
library(tmap)
library(maptiles)
library(janitor)
```

### Read in data

I read in the raster data and DDT fish concentration .csv.

Unsure what the .gri files are, but were not able to read it in with `rast()`.

```{r}
# read in sea sediment raster data
sed_2003 <- rast("data/sediment_rasters/sediment_totalDDT_2003.grd")
sed_2008 <- rast("data/sediment_rasters/sediment_totalDDT_2008.grd")
sed_2013 <- rast("data/sediment_rasters/sediment_totalDDT_2013.grd")
sed_2018 <- rast("data/sediment_rasters/sediment_totalDDT_2018.grd")

# read in fish ddt concentration data
ddt_fish <- read_csv("data/fish_data/totalDDT_fish_SouthernCA.csv")
```

Here I tried to read in the fish DDT concentrations as an sf file to plot it as a map kinda thing.  
The problem is I am not sure what the variables mean since we don't have the metadata. I am not sure what composite target longitude/latitude are (are they just longitude and latitude or something weird?). Can't remember how to convert lat/long to geometries.
```{r}
# read in fish ddt concentrations as sf
#ddt_fish_sf <- st_read(("data/fish_data/totalDDT_fish_SouthernCA.csv"),
                       #options=c("CompositeTargetLongitude=x","CompositeTargetLatitude=y")
```

### Data preparation

Cleaned the names because the variables were camel case (changed to lower snake case).

I then saved 2003, 2008, 2013, and 2018 as separate files since the sediment raster files come in those years.
```{r}
# clean names
ddt_fish_clean <- ddt_fish %>% 
  clean_names() # change column names to lower snake case

# sf file
#ddt_sf_clean <- ddt_fish_sf %>% 
  #clean_names() # change column names to lower snake case

# -------------------------------------------------------
# select years 2003, 2008, 2013, 2018 and save to separate data files
# 2003 fish ddt concentrations
ddt_fish_2003 <- ddt_fish_clean %>% 
  filter(year == 2003)

# 2008 fish ddt concentrations
ddt_fish_2008 <- ddt_fish_clean %>% 
  filter(year == 2008)

# 2013 fish ddt concentrations
ddt_fish_2013 <- ddt_fish_clean %>% 
  filter(year == 2013)

# 2018 fish ddt concentrations
ddt_fish_2013 <- ddt_fish_clean %>% 
  filter(year == 2018)
```

Disregard this chunk for now until we figure out the latitude/longitude/geometries problem.

```{r}
# -------------------------------------------------------
# select years for sf file 
#ddt_sf_2003 <- ddt_sf_clean %>% 
  #filter(year == 2003)

# 2008 fish ddt concentrations
#ddt_sf_2008 <- ddt_sf_clean %>% 
  #filter(year == 2008)

# 2013 fish ddt concentrations
#ddt_sf_2013 <- ddt_sf_clean %>% 
  #filter(year == 2013)

# 2018 fish ddt concentrations
#ddt_sf_2013 <- ddt_sf_clean %>% 
  #filter(year == 2018)
```

### Visualize rasters with tmap

Plotted all of the rasters separately. Trying to change alpha, so we can kinda see through to basemap. col_alpha = tm_const() <- how do we use this???
```{r}
# 2003 map
tm_shape(sed_2003) +
  tm_raster() +
  tm_basemap("OpenStreetMap") +
  tm_title("2003 DDT Sediment Concentrations") 

# 2008 map
tm_shape(sed_2008) +
  tm_raster() +
  tm_basemap("OpenStreetMap") +
  tm_title("2008 DDT Sediment Concentrations") 

# 2013 map
tm_shape(sed_2013) +
  tm_raster() +
  tm_basemap("OpenStreetMap") +
  tm_title("2013 DDT Sediment Concentrations") 

# 2018 map
tm_shape(sed_2018) +
  tm_raster() +
  tm_basemap("OpenStreetMap") +
  tm_title("2018 DDT Sediment Concentrations") 
```

### Visualize DDT Concentrations over time

Just plotted total DDT concentrations over time. Again, not sure what each variable is, so not sure if this visualization even makes sense.
```{r}
ggplot(ddt_fish_clean) +
  geom_point(aes(x = year, y = total_ddt)) +
  theme_minimal() +
  labs(title = "DDT Concentration in Fish Over Time") 
```
Was trying to look at fish ddt concentrations spatially, but having trouble. 
```{r}
ggplot(ddt_fish_2003) +
  geom_point(aes(x = composite_target_longitude, y = composite_target_latitude, color = total_ddt)) + theme_minimal() +
  labs(title = "Fish DDT concentration?")
```

### More visualizations to make...
Total DDT concentrations spatially.
* Need to know what each variable means 

Once we understand the variables we can understand which visualizations will be good to use.
